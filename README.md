# _Desktop Monitor_

(See the README.md file in the upper level 'examples' directory for more information about examples.)

## How to config
LVGL and TinyUSB settings can be edited from sdkconfig.

LCD ping configurations are listed in the [display_config.h](main/display_config.h).


## How to flash
Using UART with ESP32S3 built in JTAG

## Folder contents

The project **Desktop monitor** contains one source file in C language [main.c](main/main.c). The file is located in folder [main](main).

ESP-IDF projects are built using CMake. The project build configuration is contained in `CMakeLists.txt`
files that provide set of directives and instructions describing the project's source files and targets
(executable, library, or both). 

Below is short explanation of remaining files in the project folder.

```
├── lvgl_proj                  // LVGL porject
├── CMakeLists.txt
├── main
│   ├── CMakeLists.txt
│   ├── custom
│   └── (custom funtions 
│        generated by the Gui guider)
│   ├── generated
│       └── (evnets/ widages/ uisetup 
│            generated by the Gui guider)
│   ├── import
│   └── (image/ font
│        generated by the Gui guider)
│   ├── app_main.h             // Global variables
│   ├── main.c
│   ├── display_config.h       // LCD pins
│   ├── display_driver.h
│   ├── display_driver.c
│   ├── tinyusb_cdc.h
│   ├── tinyusb_cdc.c
│   ├── lv_conf.h              // Not used for now
│   ├── metrics.h
│   ├── metrics.c              // Package decoding and sending
│   └── managed_components
│       └── (components from ESP Component Registry)
├── partition.csv              // Flash partition table
└── README.md                  // This is the file you are currently reading
```

## Metrics structure

Metrics are delivered as a 26-byte little-endian packet that matches `pc_metrics_packet_t` in
`main/metrics.h`. Packet version `0x02` adds wall-clock data to the original metrics payload.

| Offset (bytes) | Field                      | Type      | Units / Notes                                   |
| -------------- | -------------------------- | --------- | ----------------------------------------------- |
| 0              | `magic`                    | `uint8`   | Must be `0xA5`                                  |
| 1              | `version`                  | `uint8`   | Currently `0x02`                                |
| 2-3            | `cpu_usage_tenths`         | `uint16`  | CPU utilisation in 0.1% steps                   |
| 4-5            | `cpu_temp_tenths`          | `int16`   | CPU temperature in 0.1 °C steps                 |
| 6-7            | `cpu_freq_mhz`             | `uint16`  | CPU frequency in MHz                            |
| 8-9            | `gpu_usage_tenths`         | `uint16`  | GPU utilisation in 0.1% steps                   |
| 10-11          | `gpu_temp_tenths`          | `int16`   | GPU temperature in 0.1 °C steps                 |
| 12-13          | `gpu_freq_mhz`             | `uint16`  | GPU frequency in MHz                            |
| 14-15          | `gram_usage_tenths`        | `uint16`  | Graphics RAM usage in 0.1% steps                |
| 16-17          | `ram_usage_tenths`         | `uint16`  | System RAM usage in 0.1% steps                  |
| 18-19          | `year`                     | `uint16`  | Gregorian calendar year (0 if missing)          |
| 20             | `month`                    | `uint8`   | Month number (1–12, 0 if missing)               |
| 21             | `day`                      | `uint8`   | Day of month (1–31, 0 if missing)               |
| 22             | `day_of_week`              | `uint8`   | Day-of-week index (0–7, 0 if missing)           |
| 23             | `hour`                     | `uint8`   | Hour (0–23, 0 if missing)                       |
| 24             | `minute`                   | `uint8`   | Minute (0–59, 0 if missing)                     |
| 25             | `second`                   | `uint8`   | Second (0–59, 0 if missing)                     |

Example packet (`A5 02 78 00 C2 01 10 0E 30 02 8A 02 DC 05 A4 01 26 02 E9 07 0A 12 06 0D 0C 2D`) decodes to:

- CPU: 12.0% @ 3.60 GHz, 45.0 °C  
- GPU: 56.0% @ 1.50 GHz, 65.0 °C  
- Graphics RAM usage: 42.0%  
- System RAM usage: 55.0%  
- Date/time: 2025-10-18 (weekday index 6) 13:12:45


I (126547) app_main: HA Switch state update: off (changed 2025-12-11T13:52:24.208492+00:00)
I (126567) app_main: HA AC state update: heat (changed 2025-12-11T13:52:27.055540+00:00, temp 25.0)
I (126613) app_main: HA weather state update: partlycloudy (changed 2025-12-11T11:34:31.921944+00:00, temp 12.2)
I (126633) app_main: HA state update (sensor.6_humidity): 47 (changed 2025-12-11T14:08:32.005639+00:00)
I (126655) app_main: HA state update (sensor.6_temperature): 23.4 (changed 2025-12-11T14:07:23.806806+00:00)
I (126673) app_main: HA state update (sensor.5_humidity): 42 (changed 2025-12-11T14:06:00.150303+00:00)
I (126692) app_main: HA state update (sensor.5_temperature): 19.8 (changed 2025-12-11T14:12:15.853921+00:00)

known bug:
ha setting keep at waiting
sntp keep waiting for system time to be set
web restart slow